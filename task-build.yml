---
platform: linux

image_resource:
  type: docker-image
  source: {repository: ubuntu}

inputs:
- name: node-app

run:
  path: sh
  args:
  - -c
  - |
    apt-get update -y && apt-get upgrade -y
    apt-get install wget -y
    wget --version
    apt-get install -y libgnutls-dev
    apt-get install -y build-essential
    apt-get install -y pkg-config
    cd /usr/share
    wget https://ftp.gnu.org/gnu/wget/wget-1.17.tar.gz
    tar xvzf wget-1.17.tar.gz
    rm wget-1.17.tar.gz
    cd wget-1.17
    ./configure
    make
    make install
    make clean
    ln -s /usr/share/wget-1.17 /usr/share/wget
    cd ../..
    wget --version
    wget https://nodejs.org/dist/v12.8.1/node-v12.8.1-linux-x64.tar.gz
    tar -C /usr/local --strip-components 1 -xzf node-v12.8.1-linux-x64.tar.gz
    ls -l /usr/local/bin/node
    ls -l /usr/local/bin/npm
    node -v
    npm -v
    cd node-app
    npm install
    npm audit fix
    npm test
    cd examples
    npm install
    npm install -g npm-cli-login
    npm-cli-login -u mar00nie -p dissertationproject -e yangyangteng@hotmail.com
    npm whoami
    npm publish
